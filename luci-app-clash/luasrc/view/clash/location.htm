

<fieldset class="cbi-section">
	<table width="100%" cellspacing="10">
	
	    <tr><td width="33%"><span><%:Global IP%> </span>&nbsp;:&nbsp;<span id="ip-gb"></span></td>  <td width="33%">  <span><%:Google%></span>&nbsp;:&nbsp;<span id="_google"><em><%:Collecting data...%></em></span></td><td><span><%:Youtube%> </span>&nbsp;:&nbsp;<span id="_youtube"><em><%:Collecting data...%></em></span></td></tr>    
		<tr><td width="33%"><span><%:Domestic IP%> </span>&nbsp;:&nbsp;<span id="d-ip"></span></td>  <td width="33%"> <span><%:Baidu%></span>&nbsp;:&nbsp;<span  id="_baidu"><em><%:Collecting data...%></em></span></td> <td><span><%:Taobao%> </span>&nbsp;:&nbsp;<span id="_taobao"><em><%:Collecting data...%></em></span></td></tr>

		
	</table>
</fieldset>


<script type="text/javascript"> //<![CDATA[


window.ipCallback = (data) => HTTP.DomesticIP(data);
			
//window.getgeoip = (data) => HTTP.GlobalIP(data);



var HTTP = {
	checker: (domain, cbElID) => {
		let img = new Image;
		let timeout = setTimeout(() => {
			img.onerror = img.onload = null;
			img = null;
			document.getElementById(cbElID).innerHTML = '<em><b><font color=red><%:UNAVAILABLE%></font></b></em>'
		}, 3000);
		img.onerror = () => {
			clearTimeout(timeout);
			document.getElementById(cbElID).innerHTML = '<em><b><font color=red><%:TIMEOUT%></font></b></em>'
		}
		img.onload = () => {
			clearTimeout(timeout);
			document.getElementById(cbElID).innerHTML = '<em><b><font color=green><%:NORMAL%></font></b></em>'
		}
		img.src = `https://${domain}/favicon.ico?${+(new Date)}`
	},
	DomesticIP: (data) => {
        	document.getElementById('d-ip').innerHTML = data.ip;
		             
	},

        //GlobalIP: (data) => {
        //        document.getElementById('ip-gb').innerHTML = data.ip;
        //}

	

}

XHR.poll(1, '<%=luci.dispatcher.build_url("admin", "services", "clash", "status")%>', null, function(x, status) {
		if ( x && x.status == 200 ) {
			globalip();		
			HTTP.checker('www.baidu.com', '_baidu');
			HTTP.checker('www.google.com', '_google');
			HTTP.checker('www.youtube.com', '_youtube');
			HTTP.checker('www.taobao.com', '_taobao');


		}
});

//]]></script>

<script src="https://www.taobao.com/help/getip.php"></script>
<!--<script type="application/javascript" src="https://api.ip.sb/geoip?callback=getgeoip"></script>-->
<!--<script type="application/javascript" src="https://api-ipv4.ip.sb/jsonip?callback=getgeoip"></script>-->


<script type="application/javascript">
//window.onload = function() {

function globalip() {
		$.getJSON("https://api.ipgeolocation.io/getip", function(data){
			console.log(data)
			document.getElementById('ip-gb').innerHTML = data.ip;
		})  
}
</script>



